\documentclass[a4paper,11pt]{article}

\usepackage[french]{babel}
\usepackage[utf8]{inputenc}
\usepackage[left=2.5cm,top=2cm,right=2.5cm,nohead,nofoot]{geometry}
\usepackage{url}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{color}
\usepackage{listings}
\DeclareMathOperator*{\join}{\bowtie}
\DeclareMathOperator*{\alpham}{\alpha}



\linespread{1.1}

\begin{document}

\section{Requ\^ete 1}
    \begin{lstlisting}
    SELECT DISTINCT subs.userID, subs.lastname, subs.firstname, subs.addresscity, stations.name FROM trips 
    INNER JOIN subs ON subs.userID = trips.userID
    INNER JOIN stations ON trips.startStation = stations.stationID
    WHERE subs.addresscity='Ixelles' and stations.name = 'FLAGEY';
    \end{lstlisting}

    \begin{align}
    joinedTables \leftarrow trips \bowtie subs \bowtie_{startStation = stationID} \\
    filteredTables \leftarrow \sigma_{addresscity=Ixelles \bigwedge name=FLAGEY}(joinedTables)
    \end{align}

\section{Requ\^ete 1}
    \begin{lstlisting}
    SELECT trips.user
    FROM trips
    GROUP BY trips.user
    HAVING COUNT(trips.user) >= 2;
    \end{lstlisting}


\section{Requ\^ete 1}
    \begin{lstlisting}
    SELECT DISTINCT trip1.user, trip2.user
    FROM trips AS trip1
    INNER JOIN trips AS trip2 ON trip1.start = trip2.start AND trip1.ending = trip2.ending AND trip1.user != trip2.user;
    \end{lstlisting}


\section{Requ\^ete 1}
    \begin{lstlisting}
    SELECT DISTINCT trip1.endingStation, trip1.endingTime, trip2.startStation, trip2.startTime
    FROM trips AS trip1
    INNER JOIN trips AS trip2 ON trip1.bicycleID = trip2.bicycleID AND trip1.startTime < trip2.startTime
    GROUP BY trip2.startTime
    HAVING trip1.endingStation != trip2.startStation
    ORDER BY trip1.startTime ASC
    \end{lstlisting}
    \begin{gather}
    trips1 \leftarrow \alpha_{attributes:t1.attributes}(trips)\\
    trips2 \leftarrow \alpha_{attributes:t2.attributes}(trips)\\
    joinedTables \leftarrow trips1 \bowtie_{t1.bicycleID = t2.bicycleID \bigwedge t1.startTime < t2.startTime} trips2 \\
    result \leftarrow \sigma_{t1.endingStation != t2.startStation} (\gamma_{t2.startTime}(joinedTables))
    \end{gather}


\section{Requ\^ete 1}
    \begin{lstlisting}
    SELECT userID, lastname, firstname, subscribeDate, total_trips, total_distance, total_distance/total_trips
    FROM(
        SELECT users.userID AS userID, subs.lastname AS lastname, subs.firstname AS firstname,
            (CASE WHEN subs.subscribeDate IS NOT NULL THEN subs.subscribeDate ELSE tempUsers.paymentDate END) AS subscribeDate,
            COUNT(*) AS total_trips,
            SUM(sqrt(power((s1.coordX-s2.coordX)*71, 2) + power((s1.coordY-s2.coordY)*111, 2))) AS total_distance
        FROM trips
        INNER JOIN users ON users.userID = trips.user
        INNER JOIN stations AS s1 ON s1.stationID = trips.start
        INNER JOIN stations AS s2 ON s2.stationID = trips.ending
        LEFT OUTER JOIN subs ON subs.userID = users.userID
        LEFT OUTER JOIN tempUsers ON tempUsers.userID = users.userID
        GROUP BY trips.user
        ORDER BY COUNT(trips.user)
    );
    \end{lstlisting}


\section{Requ\^ete 1}
    \begin{lstlisting}
    SELECT stations.name, COUNT(trips.ending), COUNT(DISTINCT trips.user)
    FROM stations
    INNER JOIN trips ON trips.ending = stations.stationID
    GROUP BY trips.ending
    HAVING COUNT(trips.ending) >= 10;
    \end{lstlisting}


\end{document}